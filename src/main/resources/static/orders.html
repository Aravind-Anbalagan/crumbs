<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Orders List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0 0 70px 0; /* bottom padding for fixed pagination */
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #cccccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            position: sticky; /* freeze header */
            top: 0;
            z-index: 5; /* ensure it stays above table rows */
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .table-container {
            overflow-y: auto;
            max-height: calc(100vh - 120px); /* table scroll area minus header/padding */
        }

        /* Pagination fixed at bottom */
        #pagination {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 6px 10px;
            border-radius: 6px;
            box-shadow: 0 0 6px rgba(0,0,0,0.1);
            z-index: 999;
            text-align: center;
        }

        #pagination button {
            margin: 0 3px;
            padding: 6px 12px;
            border: 1px solid #ccc;
            background-color: white;
            cursor: pointer;
        }

        #pagination button.active {
            background-color: #007BFF;
            color: white;
            border-color: #007BFF;
        }

        #pagination button:disabled {
            background-color: #eee;
            color: #999;
            cursor: default;
        }
    </style>
</head>
<body>
    <div class="table-container">
        <table id="ordersTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Active</th>
                    <th>Type</th>
                    <th>Exchange</th>
                    <th>Token</th>
                    <th>Symbol</th>
                    <th>Timestamp</th>
                    <th>Entry Time</th>
                    <th>Entry Price</th>
                    <th>Exit Time</th>
                    <th>Exit Price</th>
                    <th>Points</th>
                    <th>Lot Size</th>
                    <th>Max High</th>
                    <th>Max Low</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data rows will be inserted here -->
            </tbody>
        </table>
    </div>

    <div id="pagination"></div>

    <script>
        const rowsPerPage = 10;
        let currentPage = 1;
        let ordersData = [];

        async function loadOrders() {
            try {
                const response = await fetch('/api/orders');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                ordersData = await response.json();
                currentPage = 1;
                renderTablePage(currentPage);
                renderPagination();
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function renderTablePage(page) {
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';

            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageItems = ordersData.slice(start, end);

            pageItems.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id ?? ''}</td>
                    <td>${order.name ?? ''}</td>
                    <td>${order.active ?? ''}</td>
                    <td>${order.type ?? ''}</td>
                    <td>${order.exchange ?? ''}</td>
                    <td>${order.token ?? ''}</td>
                    <td>${order.symbol ?? ''}</td>
                    <td>${order.timestamp ?? ''}</td>
                    <td>${order.entryTime ?? ''}</td>
                    <td>${order.entryPrice ?? ''}</td>
                    <td>${order.exitTime ?? ''}</td>
                    <td>${order.exitPrice ?? ''}</td>
                    <td>${order.points ?? ''}</td>
                    <td>${order.lotSize ?? ''}</td>
                    <td>${order.maxHigh ?? ''}</td>
                    <td>${order.maxLow ?? ''}</td>
                    <td>${order.result ?? ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(ordersData.length / rowsPerPage);
            if (totalPages === 0) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Prev';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                currentPage--;
                renderTablePage(currentPage);
                renderPagination();
            };
            pagination.appendChild(prevButton);

            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                if (i === currentPage) btn.classList.add('active');
                btn.onclick = () => {
                    currentPage = i;
                    renderTablePage(currentPage);
                    renderPagination();
                };
                pagination.appendChild(btn);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Next';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                currentPage++;
                renderTablePage(currentPage);
                renderPagination();
            };
            pagination.appendChild(nextButton);
        }

        window.onload = loadOrders;
    </script>
</body>
</html>
